<template>
    <div if:true={showSpinner} class="slds-spinner_container">
        <lightning-spinner variant="brand" alternative-text={spinnerAlternativeText}></lightning-spinner>
    </div>
    <div class="slds-grid slds-grid_vertical slds-is-fixed slds-grid_frame">
        <div class="slds-builder-header_container slds-is-relative">
            <builder_platform_interaction-header
                flow-name={properties.label}
                flow-version={properties.versionNumber}
                run-in-mode={properties.runInMode}
                help-url={helpUrl}
                trailhead-url={trailheadUrl}
                trailblazer-community-url={trailblazerCommunityUrl}
                back-url={backUrl}
                builder-icon={builderIcon}
                builder-name={builderName}
                guardrails-params={guardrailsParams}
                interview-label={interviewLabel}
                show-interview-label={showInterviewLabel}
                show-debug-status={showDebugStatus}
                debug-interview-status={debugInterviewStatus}
            ></builder_platform_interaction-header>
            <builder_platform_interaction-toolbar
                ontoggleselectionmode={handleToggleSelectionMode}
                oncopy={handleCopy}
                onclick={handleLeftPanelAndToolbarInteraction}
                onduplicate={handleDuplicate}
                oneditflowproperties={handleEditFlowProperties}
                oneditflow={handleEditFlow}
                onrunflow={handleRunFlow}
                ondebugflow={handleDebugFlow}
                onnewdebugflow={handleNewDebugFlow}
                onrestartdebugflow={handleRestartDebugFlow}
                onsaveas={handleSaveFlow}
                onsave={handleSaveFlow}
                ondiffflow={handleDiffFlow}
                onundo={handleUndo}
                onredo={handleRedo}
                ontoggleflowstatus={handleToggleFlowStatus}
                onclosepropertyeditor={handleClosePropertyEditor}
                show-copy-paste-button={toolbarConfig.showCopyPasteButton}
                show-edit-flow-properties-button={toolbarConfig.showEditFlowPropertiesButton}
                show-canvas-mode-toggle={toolbarConfig.showCanvasModeToggle}
                show-edit-flow-button={toolbarConfig.showEditFlowButton}
                show-run-button={toolbarConfig.showRunButton}
                show-debug-button={toolbarConfig.showDebugButton}
                show-restart-run-button={showDebugAgainButton}
                show-flow-status={toolbarConfig.showFlowStatus}
                flow-errors-and-warnings={flowErrorsAndWarnings}
                save-and-pending-operation-status={saveAndPendingOperationStatus}
                last-modified-date={properties.lastModifiedDate}
                flow-id={flowId}
                flow-version={properties.versionNumber}
                flow-status={flowStatus}
                is-edit-flow-properties-disabled={hasNotBeenSaved}
                is-run-debug-disabled={isRunDebugDisabled}
                is-save-disabled={disableSave}
                is-save-as-disabled={hasNotBeenSaved}
                is-selection-mode={isSelectionMode}
                is-cut-copy-disabled={isCutCopyDisabled}
                is-undo-disabled={isUndoDisabled}
                is-redo-disabled={isRedoDisabled}
                is-new-debug-supported={useNewDebugExperience}
                is-lightning-flow-builder={properties.isLightningFlowBuilder}
                can-only-save-as-new-definition={properties.canOnlySaveAsNewDefinition}
                has-unsaved-changes={properties.hasUnsavedChanges}
                ontogglecanvasmode={handleToggleCanvasMode}
                is-auto-layout-canvas={properties.isAutoLayoutCanvas}
            ></builder_platform_interaction-toolbar>
        </div>
        <div class="slds-col slds-grow slds-grid">
            <builder_platform_interaction-left-panel
                if:true={showLeftPanel}
                onaddnewresource={handleAddResourceElement}
                onaddelement={handleAddCanvasElement}
                onclick={handleLeftPanelAndToolbarInteraction}
                oneditelement={handleEditElement}
                ondeleteelement={handleElementDelete}
                onlocatoriconclicked={handleHighlightOnCanvas}
                elements={toolboxElements}
                palette={palette}
                show-elements-tab={showLeftPanelElementsTab}
                show-locator-icon={showLocatorIconInLeftPanel}
            ></builder_platform_interaction-left-panel>
            <div if:true={hasCanvasElements} class="slds-col">
                <!--
                    W-7866257: Make sure the fixed canvas comes first as both canvas can be in the DOM at the same time
                    for brief moment when toggling (LWC bug?), and the fixed canvas use the offsets of its container
                -->
                <builder_platform_interaction-canvas-container
                    if:false={properties.isAutoLayoutCanvas}
                    canvas-config={canvasConfig}
                    onaddelement={handleAddCanvasElement}
                    oneditelement={handleEditElement}
                    ondeleteelement={handleElementDelete}
                    ontogglemarqueeon={handleClosePropertyEditor}
                    onclosepropertyeditor={handleClosePropertyEditor}
                    onnodeselected={handleNodeSelected}
                >
                </builder_platform_interaction-canvas-container>
                <builder_platform_interaction-flc-builder-container
                    if:true={properties.isAutoLayoutCanvas}
                    elements-metadata={elementsMetadata}
                    is-selection-mode={isSelectionMode}
                    is-paste-available={isPasteAvailable}
                    onaddelement={handleAddCanvasElement}
                    oncopysingleelement={handleCopySingleElement}
                    ondeleteelement={handleElementDelete}
                    oneditelement={handleEditElement}
                    ontoggleselectionmode={handleToggleSelectionMode}
                    onflcselection={handleSelectionOnFixedCanvas}
                    onpaste={handlePasteOnCanvas}
                    onclosepropertyeditor={handleClosePropertyEditor}
                    onnodeselected={handleNodeSelectedOnFixedCanvas}
                    onaddelementfault={handleAddElementFault}
                    ondeleteelementfault={handleDeleteElementFault}
                    onflccreateconnection={handleFlcCreateConnection}
                >
                </builder_platform_interaction-flc-builder-container>
            </div>
            <builder_platform_interaction-right-panel
                if:true={showRightPanel}
                onaddnewresource={handleAddResourceElement}
                onclosepropertyeditor={handleClosePropertyEditor}
                onaddnode={handleAddNode}
                onupdatenode={handleUpdateNode}
                is-variable-width={isRightPanelVariableWidth}
            >
                <builder_platform_interaction-property-editor-panel
                    if:true={showPropertyEditorRightPanel}
                    element={elementBeingEditedInPanel}
                    params={propertyEditorParams}
                    node-update-callback={propertyEditorParams.attr.nodeUpdate}
                >
                </builder_platform_interaction-property-editor-panel>
                <builder_platform_interaction-debug-panel if:true={showDebugPanel} debug-data={debugTraces}>
                </builder_platform_interaction-debug-panel>
            </builder_platform_interaction-right-panel>
        </div>
    </div>
</template>
