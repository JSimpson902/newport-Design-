<template>
    <div class="slds-panel__header" tabindex="-1">
        <h2 class="slds-panel__header-title slds-text-heading_small slds-truncate">{labels.debugInspector}</h2>
    </div>
    <!-- filter gear icon and selected filters text-->
    <div class="slds-grid slds-border_bottom">
        <div class="slds-m-left_small slds-m-vertical_x-small">
            <lightning-button
                variant="Neutral"
                label={expandLabelVar}
                title={expandTitleVar}
                onclick={handleExpandAll}
                class="slds-m-left_x-medium test-expand-button"
            >
            </lightning-button>
        </div>
        <div class="slds-m-left_xxx-small slds-m-vertical_xx-small">
            <builder_platform_interaction-debug-panel-filter
                onpanelfilter={handleDropdown}
                selections={selectedOptions}
            >
            </builder_platform_interaction-debug-panel-filter>
            <!-- popover containing checkboxes for filters -->
            <template if:true={showOptions}>
                <section
                    aria-label={labels.filterPopoverAltText}
                    aria-describedby="popover-body-id"
                    class="slds-popover slds-is-absolute slds-nubbin_top-left slds-m-left_xx-small"
                    role="popover"
                >
                    <div id="popover-body-id" class="slds-popover__body">
                        <!--- close popover icon -->
                        <lightning-button-icon
                            icon-name="utility:close"
                            onclick={handleDropdown}
                            variant="bare"
                            alternative-text={labels.filterClosePopoverAltText}
                            class="slds-float_right slds-popover__close"
                            title={labels.filterClosePopoverAltText}
                        >
                        </lightning-button-icon>
                        <!-- popover body-->
                        <lightning-checkbox-group
                            name={labels.filterTitleText}
                            label={labels.filterTitleText}
                            options={options}
                            value={checkboxSelections}
                            onchange={handleFilterChange}
                        >
                        </lightning-checkbox-group>
                    </div>
                </section>
            </template>
        </div>
    </div>

    <div class="slds-panel__body slds-scrollable--y">
        <!-- if there's an error, there will be no debugData.debugTraces-->
        <lightning-accordion
            allow-multiple-sections-open
            class="slds-has-divider--bottom slds-p-around_none slds-m-around_none"
            active-section-name={activeSections}
            onsectiontoggle={handleSectionToggle}
        >
            <template for:each={debugTraces} for:item="trace">
                <template key={trace.id} if:true={showApiNames}>
                    <builder_platform_interaction-accordion-section-with-icon
                        data-name={trace.titleWithApiName}
                        key={trace.id}
                        label={trace.titleWithApiName}
                        name={trace.titleWithApiName}
                        element-icon={trace.elementIcon}
                    >
                        <builder_platform_interaction-debug-panel-body
                            lines={trace.lines}
                            error={trace.error}
                            title={trace.titleWithApiName}
                            waitevents={trace.waitevents}
                            resumetime={trace.resumetime}
                            limits={trace.limits}
                            ifblockresume={ifBlockResume}
                            show-gov-lim={showGovLim}
                        ></builder_platform_interaction-debug-panel-body>
                    </builder_platform_interaction-accordion-section-with-icon>
                </template>

                <template key={trace.id} if:false={showApiNames}>
                    <builder_platform_interaction-accordion-section-with-icon
                        data-name={trace.titleWithLabel}
                        key={trace.id}
                        label={trace.titleWithLabel}
                        name={trace.titleWithLabel}
                        element-icon={trace.elementIcon}
                    >
                        <builder_platform_interaction-debug-panel-body
                            lines={trace.lines}
                            error={trace.error}
                            title={trace.titleWithLabel}
                            waitevents={trace.waitevents}
                            resumetime={trace.resumetime}
                            limits={trace.limits}
                            ifblockresume={ifBlockResume}
                            show-gov-lim={showGovLim}
                        ></builder_platform_interaction-debug-panel-body>
                    </builder_platform_interaction-accordion-section-with-icon>
                </template>
            </template>
            <template if:true={showTestAssertions}>
                <lightning-accordion-section label={labels.flowTestOutcomesLabel} name={labels.flowTestOutcomesLabel}>
                    <builder_platform_interaction-test-panel-body
                        test-assertion-trace={testAssertionTrace}
                    ></builder_platform_interaction-test-panel-body>
                </lightning-accordion-section>
            </template>
        </lightning-accordion>

        <div if:true={hasErrors} class="error">
            <lightning-formatted-rich-text
                value={errorMessage}
                disable-linkify="true"
                class="errorMsg"
            ></lightning-formatted-rich-text>
        </div>
    </div>
</template>
