<template>
    <div class="slds-p-horizontal_small slds-p-top_small">{labels.recordUpdateTitle}</div>
    <div class="slds-p-horizontal_small slds-p-top_small">
        <builder_platform_interaction-label-description
            label={state.recordUpdateElement.label}
            dev-name={state.recordUpdateElement.name}
            description={state.recordUpdateElement.description}
            guid={state.recordUpdateElement.guid}
            onpropertychanged={handlePropertyOrListItemChanged}
            mode={mode}
        >
        </builder_platform_interaction-label-description>
    </div>

    <!-- Record Store Fields Selection section -->
    <builder_platform_interaction-record-store-options
        element-type={state.recordUpdateElement.elementType}
        resource-display-text={state.resourceDisplayText}
        number-of-records-to-store={numberRecordsToStoreValue}
        onrecordstoreoptionchanged={handleRecordStoreOptionChanged}
    >
    </builder_platform_interaction-record-store-options>

    <div if:true={isSObjectMode}>
        <div class="slds-m-bottom_small slds-border_top">
            <h3 class="slds-text-heading_small slds-p-around_small">{labels.selectRecordsToUpdate}</h3>
            <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2 slds-m-bottom_small">
                <builder_platform_interaction-sobject-or-sobject-collection-picker
                    label={labels.recordVariableOrRecordCollectionVariable}
                    placeholder={labels.searchRecords}
                    value={inputReference}
                    row-index={state.recordUpdateElement.inputReferenceIndex.value}
                    error-message={state.recordUpdateElement.inputReference.error}
                    sobject-collection-criterion={sobjectCollectionCriterion}
                    updateable="true"
                    onsobjectreferencechanged={handleInputReferenceChangedEvent}
                    is-pill-supported
                >
                </builder_platform_interaction-sobject-or-sobject-collection-picker>
            </div>
        </div>
        <div class="slds-p-horizontal_small slds-m-bottom_small slds-grid">
            <div class="slds-m-top_xx-small">
                <span>{labels.helpIdFieldPopulatedWithTextForUpdate}</span>
            </div>
            <lightning-helptext
                class="slds-m-left_xx-small"
                content={labels.helpSObjectRecordUpdateAltText}
            ></lightning-helptext>
        </div>
    </div>
    <div if:false={isSObjectMode} class="slds-m-bottom_small slds-border_top fieldAssignmentNotSupported">
        <!-- sobject picker -->
        <div class="slds-m-bottom_small slds-border_top">
            <h3 class="slds-text-heading_small slds-p-around_small">{labels.updateRecordOfThisObject}</h3>
            <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
                <builder_platform_interaction-entity-resource-picker
                    combobox-config={entityComboboxConfig}
                    value={state.recordEntityName}
                    row-index={state.recordUpdateElement.objectIndex.value}
                    crud-filter-type={crudFilterType}
                    oncomboboxstatechanged={handleResourceChanged}
                    onitemselected={handleResourceChanged}
                >
                </builder_platform_interaction-entity-resource-picker>
            </div>
        </div>
        <div if:true={state.recordEntityName}>
            <!-- Find Records section -->
            <builder_platform_interaction-record-filter
                show-prefix
                element-type={state.recordUpdateElement.elementType}
                element-guid={state.recordUpdateElement.guid}
                filter-items={state.recordUpdateElement.filters}
                filter-logic={state.recordUpdateElement.filterLogic}
                record-entity-name={state.recordEntityName}
                record-fields={recordFieldsToFilter}
                onaddrecordfilter={handlePropertyOrListItemChanged}
                onupdaterecordfilter={handlePropertyOrListItemChanged}
                ondeleterecordfilter={handlePropertyOrListItemChanged}
                onpropertychanged={handlePropertyOrListItemChanged}
            >
            </builder_platform_interaction-record-filter>

            <!-- InputAssignments fields -->
            <builder_platform_interaction-record-input-output-assignments
                input-output-assignments-items={state.recordUpdateElement.inputAssignments}
                resource-display-text={resourceDisplayText}
                record-entity-name={state.recordEntityName}
                record-fields={recordFieldsToUpdate}
                element-type={state.recordUpdateElement.elementType}
                title={assignmentTitle}
                rhs-label={labels.filterRhsLabel}
                onupdaterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                onaddrecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                ondeleterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            >
            </builder_platform_interaction-record-input-output-assignments>
        </div>
    </div>
</template>
