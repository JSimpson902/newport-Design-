<template>
    <template if:false={_displaySpinner}>
        <div if:true={field} class="container full-height">
            <div if:true={extensionDescription}>
                <section class="slds-p-horizontal_small">
                    <builder_platform_interaction-screen-property-field
                        label={labels.apiNameLabel}
                        name="name"
                        required="required"
                        type="string"
                        value={field.name}
                    >
                    </builder_platform_interaction-screen-property-field>

                    <template
                        if:true={showDynamicTypeMappings}
                        for:each={state.dynamicTypeMappings}
                        for:item="dynamicTypeMapping"
                    >
                        <builder_platform_interaction-entity-resource-picker
                            key={dynamicTypeMapping.name}
                            value={dynamicTypeMapping.value}
                            row-index={dynamicTypeMapping.rowIndex}
                            mode={dynamicTypeMapping.mode}
                            combobox-config={dynamicTypeMapping.comboboxConfig}
                            onitemselected={handleDynamicTypeMappingChange}
                            oncomboboxstatechanged={handleDynamicTypeMappingChange}
                        >
                        </builder_platform_interaction-entity-resource-picker>
                    </template>

                    <builder_platform_interaction-custom-property-editor
                        if:true={hasConfigurationEditor}
                        configuration-editor={configurationEditor}
                        element-info={elementInfo}
                        configuration-editor-input-variables={configurationEditorInputVariables}
                        configuration-editor-type-mappings={configurationEditorTypeMappings}
                        builder-context={builderContext}
                        automatic-output-variables={automaticOutputVariables}
                        onconfiguration_editor_input_value_changed={handleCpePropertyChangeEvent}
                        onconfiguration_editor_generic_type_mapping_changed={handleCpeTypeMappingChangeEvent}
                    >
                    </builder_platform_interaction-custom-property-editor>

                    <template if:false={hasConfigurationEditor}>
                        <template
                            if:false={hasUnboundDynamicTypeMappings}
                            for:each={state.inputParameters}
                            for:item="param"
                        >
                            <builder_platform_interaction-screen-extension-attribute-editor
                                key={param.descriptor.apiName}
                                row-index={param.rowIndex}
                                index="-1"
                                descriptor={param.descriptor}
                                attribute={param.attribute}
                                attribute-type="input"
                                disabled={param.disabled}
                            >
                            </builder_platform_interaction-screen-extension-attribute-editor>
                        </template>
                    </template>
                </section>

                <div
                    if:true={isManualOutputDisplayedBeforeAdvancedAccordionSection}
                    class="slds-m-bottom_small slds-m-top_small slds-p-top_small slds-accordion__list-item outputBeforeAccordion"
                >
                    <h3 class="slds-p-left_medium" style="font-size: 3; font-weight: bold">
                        {labels.extensionOutputsHeader}
                    </h3>
                    <div class="slds-p-left_medium slds-p-right_small slds-m-top_small">
                        <template for:each={state.outputParameters} for:item="param" for:index="index">
                            <builder_platform_interaction-screen-extension-attribute-editor
                                key={param.key}
                                row-index={param.rowIndex}
                                index={index}
                                descriptor={param.descriptor}
                                attribute={param.attribute}
                                attribute-index={param.index}
                                attribute-type="output"
                                disabled={param.disabled}
                            >
                            </builder_platform_interaction-screen-extension-attribute-editor>
                        </template>
                    </div>
                </div>

                <template if:true={showExtraSections}>
                    <lightning-accordion
                        allow-multiple-sections-open
                        active-section-name={expandedSectionNames}
                        class="slds-has-divider slds-p-top_none slds-border_bottom"
                    >
                        <builder_platform_interaction-screen-component-visibility-section field={field}>
                        </builder_platform_interaction-screen-component-visibility-section>

                        <lightning-accordion-section name="advanced" label={labels.extensionAdvanced}>
                            <div if:true={isAdvancedCheckboxDisplayed} class="slds-m-top_small">
                                <builder_platform_interaction-manually-assign-variables-checkbox
                                    is-advanced-mode={isAdvancedMode}
                                    onmanuallyassignvariableschanged={handleManuallyAssignVariablesChanged}
                                    input-parent-div-css=""
                                >
                                </builder_platform_interaction-manually-assign-variables-checkbox>
                            </div>

                            <div
                                if:true={isManualOutputDisplayedInAdvancedAccordionSection}
                                class="slds-m-bottom_small slds-m-top_small outputInAccordion"
                            >
                                <h3 style="font-size: 3; font-weight: bold">{labels.extensionOutputsHeader}</h3>
                                <div class="slds-m-top_small">
                                    <template for:each={state.outputParameters} for:item="param" for:index="index">
                                        <builder_platform_interaction-screen-extension-attribute-editor
                                            key={param.key}
                                            row-index={param.rowIndex}
                                            index={index}
                                            descriptor={param.descriptor}
                                            attribute={param.attribute}
                                            attribute-index={param.index}
                                            attribute-type="output"
                                            disabled={param.disabled}
                                        >
                                        </builder_platform_interaction-screen-extension-attribute-editor>
                                    </template>
                                </div>
                            </div>

                            <div class="slds-text-heading_small slds-p-vertical_small">
                                {labels.extensionInputsOnNextNavToAssocScrnSubtitle}
                            </div>
                            <div class="slds-text-body_regular">
                                {labels.extensionInputsOnNextNavToAssocScrnDescription}
                            </div>
                            <lightning-radio-group
                                name="radioButtonGroup"
                                options={inputsOnNextNavToAssocScrnOptions}
                                value={field.inputsOnNextNavToAssocScrn}
                                onchange={handleInputsOnNextNavToAssocScrnChange}
                            >
                            </lightning-radio-group>
                        </lightning-accordion-section>
                    </lightning-accordion>
                </template>
            </div>
        </div>
    </template>

    <div if:true={_displaySpinner} class="slds-is-relative full-height slds-shrink">
        <lightning-spinner
            alternative-text={labels.spinnerAlternativeText}
            size="medium"
            variant="brand"
            class="spinner"
        ></lightning-spinner>
    </div>
</template>
