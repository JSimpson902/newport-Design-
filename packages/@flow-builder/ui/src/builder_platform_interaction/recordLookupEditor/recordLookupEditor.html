<template>
    <div class="slds-p-horizontal_small slds-p-top_small">
        {labels.recordLookupTitle}
    </div>
    <div class="slds-p-horizontal_small slds-p-top_small">
        <builder_platform_interaction-label-description
            label={state.recordLookupElement.label}
            dev-name={state.recordLookupElement.name}
            description={state.recordLookupElement.description}
            guid={state.recordLookupElement.guid}
            onpropertychanged={handlePropertyOrListItemChanged}
            mode={mode}
        >
        </builder_platform_interaction-label-description>
    </div>

    <!-- Entity picker (object) -->
    <div class="slds-m-bottom_small slds-border_top">
        <h3 class="slds-text-heading_small slds-p-around_small">
            {labels.getRecordsOfObjectType}
        </h3>
        <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
            <builder_platform_interaction-entity-resource-picker
                combobox-config={entityComboboxConfig}
                value={state.recordLookupElement.object.value}
                row-index={state.recordLookupElement.objectIndex.value}
                crud-filter-type={crudFilterType}
                oncomboboxstatechanged={handleResourceChanged}
                onitemselected={handleResourceChanged}
            >
            </builder_platform_interaction-entity-resource-picker>
        </div>
    </div>

    <div if:true={recordEntityName}>
        <!-- Find Records section -->
        <builder_platform_interaction-record-filter
            element-type={elementType}
            filter-items={state.recordLookupElement.filters}
            record-entity-name={recordEntityName}
            resource-display-text={resourceDisplayText}
            record-fields={recordFields}
            filter-type={state.recordLookupElement.filterType}
            onrecordfiltertypechanged={handleFilterTypeChanged}
            onaddrecordfilter={handlePropertyOrListItemChanged}
            onupdaterecordfilter={handlePropertyOrListItemChanged}
            ondeleterecordfilter={handlePropertyOrListItemChanged}
        >
        </builder_platform_interaction-record-filter>

        <!-- Sort Records section -->
        <builder_platform_interaction-record-sort
            resource-api-name={recordEntityName}
            resource-display-text={resourceDisplayText}
            selected-field={state.recordLookupElement.sortField.value}
            sort-order={state.recordLookupElement.sortOrder}
            sort-field-error={state.recordLookupElement.sortField.error}
            onchange={handleRecordSortChanged}
        >
        </builder_platform_interaction-record-sort>

        <!-- Automatic output is not supported -->
        <div if:false={isAutomaticOutputHandlingSupported}>
            <!-- Record Store Fields Selection section -->
            <builder_platform_interaction-record-store-options
                element-type={elementType}
                resource-display-text={resourceDisplayText}
                number-of-records-to-store={numberRecordsToStoreValue}
                way-to-store-fields={wayToStoreFieldsValue}
                assign-null-values-if-no-records-found={state.recordLookupElement.assignNullValuesIfNoRecordsFound}
                display-way-to-store-fields={displayWayToStoreFields}
                onrecordstoreoptionchanged={handleRecordStoreOptionsChanged}
            >
            </builder_platform_interaction-record-store-options>

            <!-- SObject or SObject collection section -->
            <builder_platform_interaction-record-sobject-and-query-fields
                if:true={isSObjectMode}
                is-collection={isCollection}
                record-entity-name={recordEntityName}
                resource-display-text={resourceDisplayText}
                queried-fields={state.recordLookupElement.queriedFields}
                output-reference={outputReferenceValue}
                output-reference-index={state.recordLookupElement.outputReferenceIndex.value}
                sobject-variable-error-message={outputReferenceErrorMessage}
                sobject-collection-criterion={sObjectCollectionCriterion}
                queryable="true"
                onsobjectreferencechanged={handleSObjectReferenceChanged}
                onaddrecordlookupfield={handlePropertyOrListItemChanged}
                onupdaterecordlookupfield={handlePropertyOrListItemChanged}
                ondeleterecordlookupfield={handlePropertyOrListItemChanged}
            >
            </builder_platform_interaction-record-sobject-and-query-fields>

            <builder_platform_interaction-record-input-output-assignments
                if:false={isSObjectMode}
                input-output-assignments-items={state.recordLookupElement.outputAssignments}
                resource-display-text={resourceDisplayText}
                record-entity-name={recordEntityName}
                record-fields={recordFields}
                element-type={elementType}
                is-output
                title={assignmentTitle}
                rhs-label={labels.filterRhsLabel}
                onupdaterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                onaddrecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                ondeleterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            >
            </builder_platform_interaction-record-input-output-assignments>
        </div>

        <!-- Automatic output is supported -->
        <div if:true={isAutomaticOutputHandlingSupported}>
            <builder_platform_interaction-record-number-record-to-store
                label={labels.numberRecordsToStoreLabel}
                record-store-options={recordStoreOptions}
                number-records-to-store-value={numberRecordsToStoreValue}
                onnumberrecordtostorechanged={handleNumberRecordsToStoreChange}
            >
            </builder_platform_interaction-record-number-record-to-store>

            <builder_platform_interaction-record-lookup-variable-and-field-mapping
                value={variableAndFieldMappingValue}
                onvariableandfieldmappingchanged={handleVariableAndFieldMappingChange}
            >
            </builder_platform_interaction-record-lookup-variable-and-field-mapping>

            <div if:true={isAutomaticAdvancedMode} class="slds-p-left_xx-large slds-p-right_small">
                <!-- Selection list of fields -->
                <builder_platform_interaction-record-query-fields
                    record-entity-name={recordEntityName}
                    resource-display-text={resourceDisplayText}
                    element-type={elementType}
                    queried-fields={state.recordLookupElement.queriedFields}
                    global-css="slds-p-left_small slds-form-element slds-size_1-of-2 slds-m-bottom_small"
                    title-css="slds-text-heading_small slds-p-top_small"
                    onaddrecordlookupfield={handlePropertyOrListItemChanged}
                    onupdaterecordlookupfield={handlePropertyOrListItemChanged}
                    ondeleterecordlookupfield={handlePropertyOrListItemChanged}
                >
                </builder_platform_interaction-record-query-fields>
            </div>

            <div if:true={isManualMode} class="slds-p-left_xx-large slds-p-right_small">
                <builder_platform_interaction-rich-label
                    label={labels.storeFieldsSelectionLabel}
                    args={resourceDisplayText}
                    class="slds-text-body_regular"
                >
                </builder_platform_interaction-rich-label>

                <lightning-radio-group
                    if:false={isCollection}
                    name="wayToStoreFieldsRadioGroup"
                    label={labels.wayToStoreFieldsLabel}
                    options={wayToStoreFieldsOptions}
                    value={wayToStoreFieldsValue}
                    onchange={handleWayToStoreFieldsChange}
                    class="slds-m-top_x-small"
                >
                </lightning-radio-group>

                <!-- SObject or SObject collection section -->
                <builder_platform_interaction-record-sobject-and-query-fields
                    if:true={isSObjectMode}
                    is-collection={isCollection}
                    s-object-variable-picker-global-css=""
                    s-object-variable-picker-title-css="slds-text-heading_small slds-p-top_small"
                    s-object-variable-picker-div-css="slds-form-element slds-size_1-of-2"
                    query-fields-global-css="slds-form-element slds-size_1-of-2 slds-m-bottom_small"
                    query-fields-title-css="slds-text-heading_small slds-p-top_small"
                    query-fields-separation-div-css=""
                    record-entity-name={recordEntityName}
                    resource-display-text={resourceDisplayText}
                    queried-fields={state.recordLookupElement.queriedFields}
                    output-reference={outputReferenceValue}
                    output-reference-index={state.recordLookupElement.outputReferenceIndex.value}
                    sobject-variable-error-message={outputReferenceErrorMessage}
                    sobject-collection-criterion={sobjectCollectionCriterion}
                    queryable="true"
                    onsobjectreferencechanged={handleSObjectReferenceChanged}
                    onaddrecordlookupfield={handlePropertyOrListItemChanged}
                    onupdaterecordlookupfield={handlePropertyOrListItemChanged}
                    ondeleterecordlookupfield={handlePropertyOrListItemChanged}
                >
                </builder_platform_interaction-record-sobject-and-query-fields>

                <builder_platform_interaction-record-input-output-assignments
                    if:false={isSObjectMode}
                    input-output-assignments-items={state.recordLookupElement.outputAssignments}
                    resource-display-text={resourceDisplayText}
                    record-entity-name={recordEntityName}
                    record-fields={recordFields}
                    element-type={elementType}
                    is-output
                    title={assignmentTitle}
                    rhs-label={labels.filterRhsLabel}
                    title-css="slds-text-heading_small slds-p-top_small"
                    list-css="slds-m-bottom_small"
                    top-div-css="slds-m-bottom_small"
                    onupdaterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                    onaddrecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                    ondeleterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
                >
                </builder_platform_interaction-record-input-output-assignments>
                <lightning-input
                    name="assignNullIfNoRecordFoundCheckbox"
                    class="property-input slds-m-top_x-small slds-m-bottom_x-small"
                    type="checkbox"
                    label={labels.assignNullValuesIfNoRecordsFoundLabel}
                    checked={assignNullValuesIfNoRecordsFound}
                    onchange={handleAssignNullValuesIfNoRecordsFoundChange}
                >
                </lightning-input>
            </div>
        </div>
    </div>
</template>
