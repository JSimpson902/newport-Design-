<template>
    <div class="slds-p-horizontal_small slds-p-top_small">
        {labels.recordLookupTitle}
    </div>
    <div class="slds-p-horizontal_small slds-p-top_small">
        <builder_platform_interaction-label-description label={state.recordLookupElement.label} dev-name={state.recordLookupElement.name} description={state.recordLookupElement.description} guid={state.recordLookupElement.guid} onpropertychanged={handlePropertyOrListItemChanged}> </builder_platform_interaction-label-description>
    </div>
    
    <!-- Entity picker (object) -->
    <div class="slds-m-bottom_small slds-border_top">
        <h3 class="slds-text-heading_small slds-p-around_small">{labels.getRecordsOfObjectType}</h3>
        <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
            <builder_platform_interaction-entity-resource-picker
                    combobox-config={entityComboboxConfig}
                    value={state.recordLookupElement.object.value}
                    crud-filter-type={crudFilterType}
                    oncomboboxstatechanged={handleResourceChanged}
                    onitemselected={handleResourceChanged}>
            </builder_platform_interaction-entity-resource-picker>
        </div>
    </div>

    <div if:true={recordEntityName}>
        <!-- Find Records section -->
        <builder_platform_interaction-record-filter 
            element-type={elementType}
            filter-items={state.recordLookupElement.filters}
            record-entity-name={recordEntityName}
            resource-display-text={resourceDisplayText}
            record-fields={recordFields}
            filter-type={state.recordLookupElement.filterType}
            onrecordfiltertypechanged={handleFilterTypeChanged}
            onaddrecordfilter={handlePropertyOrListItemChanged}
            onupdaterecordfilter={handlePropertyOrListItemChanged}
            ondeleterecordfilter={handlePropertyOrListItemChanged}>
        </builder_platform_interaction-record-filter>

        <!-- Sort Records section -->
        <builder_platform_interaction-record-sort
            resource-api-name={recordEntityName}
            resource-display-text={resourceDisplayText}
            selected-field={state.recordLookupElement.sortField.value}
            sort-order={state.recordLookupElement.sortOrder}
            sort-field-error={state.recordLookupElement.sortField.error}
            onchange={handleRecordSortChanged}>
        </builder_platform_interaction-record-sort>
                
        <!-- Record Store Fields Selection section -->
        <builder_platform_interaction-record-store-options
            element-type={elementType}
            resource-display-text={resourceDisplayText}
            number-of-records-to-store={numberRecordsToStoreValue}
            way-to-store-fields={wayToStoreFieldsValue}
            assign-null-values-if-no-records-found={state.recordLookupElement.assignNullValuesIfNoRecordsFound}
            onrecordstoreoptionchanged={handleRecordStoreOptionsChanged}>
        </builder_platform_interaction-record-store-options>
        
        <!-- SObject or SObject collection section -->
        <builder_platform_interaction-record-query-fields if:true={isSObjectMode} 
            is-collection={isCollection}
            record-entity-name={recordEntityName}
            resource-display-text={resourceDisplayText}
            element-type={elementType}
            queried-fields={state.recordLookupElement.queriedFields}
            output-reference={outputReferenceValue}
            sobject-variable-error-message={outputReferenceErrorMessage}
            onsobjectreferencechanged={handleSObjectReferenceChanged}
            onaddrecordlookupfield={handlePropertyOrListItemChanged}
            onupdaterecordlookupfield={handlePropertyOrListItemChanged}
            ondeleterecordlookupfield={handlePropertyOrListItemChanged}>
        </builder_platform_interaction-record-query-fields>
        
        <builder_platform_interaction-record-input-output-assignments 
            if:false={isSObjectMode} 
            input-output-assignments-items={state.recordLookupElement.outputAssignments}
            resource-display-text={resourceDisplayText}
            record-entity-name={recordEntityName}
            record-fields={recordFields}
            element-type={elementType}
            is-output
            title={assignmentTitle}
            rhs-label={labels.filterRhsLabel}
            onupdaterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            onaddrecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            ondeleterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}>
        </builder_platform_interaction-record-input-output-assignments>
    </div>
</template> 
