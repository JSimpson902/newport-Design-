<template>
    <div>
        <div class="slds-border_bottom left-panel">
            <builder_platform_interaction-learn-more-card
                popup-trigger-label={labels.learnMoreButtonLabel}
                side-text={labels.learnMoreSideText}
                popup-close-button-assistive-text={labels.popupCloseButtonAssistiveText}
                popup-body-text={labels.popupBodyText}
                popup-link-label={labels.knowledgeArticleButtonLabel}
                popup-link-url={knowledgeArticleLink}
            ></builder_platform_interaction-learn-more-card>

            <div class="slds-p-horizontal_small slds-p-vertical_medium">
                <builder_platform_interaction-sobject-or-sobject-collection-picker
                    label={labels.selectObjectLabel}
                    placeholder={labels.selectObjectPlaceholderLabel}
                    value={state.recordVariable}
                    error-message={sobjectPickerErrorMessage}
                    sobject-collection-criterion={sobjectCollectionCriterion}
                    crud-filter={crudFilter}
                    onsobjectreferencechanged={handleSObjectReferenceChangedEvent}
                    row-index={sObjectPickerRowIndex}
                    disable-field-drilldown
                    is-pill-supported
                    onremovemergefieldpill={handlePillRemoved}
                    new-resource-info={newResourceInfo}
                ></builder_platform_interaction-sobject-or-sobject-collection-picker>
            </div>
        </div>

        <!-- empty state container when no record var is selected  with illustration -->
        <div
            class="slds-p-horizontal_small slds-p-vertical_medium noItemsIllustration"
            if:true={showNoItemIllustrationContainer}
        >
            <builder_platform_interaction-illustration
                class=""
                illustration="lakeMountain"
                title={labels.noItemsToShowLabel}
                body={labels.noItemsToShowDescription}
            ></builder_platform_interaction-illustration>
        </div>

        <!-- filtering input and list of fields -->
        <div if:false={showNoItemIllustrationContainer}>
            <!-- error div if fields are not loaded properly -->
            <div if:true={showErrorMessageRelatedToFieldFetching} class="error">
                <span>{labels.fieldsLoadingError}</span>
            </div>
            <!-- spinner when fields are being loaded -->
            <lightning-spinner
                if:true={showLoadingFieldsSpinner}
                alternative-text={labels.spinnerAlternativeText}
                size="small"
                variant="brand"
                class="spinner"
            ></lightning-spinner>
            <!-- container for search field and palette -->
            <div if:false={showErrorMessageRelatedToFieldFetching}>
                <div if:false={showNoFieldIllustration} class="slds-p-horizontal_small slds-p-vertical_medium">
                    <div
                        title={searchInputPlaceholder}
                        class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right"
                    >
                        <input
                            id="filter-input"
                            type="text"
                            class="slds-input palette-search-input"
                            placeholder={searchInputPlaceholder}
                            oninput={handleSearch}
                            value={searchPattern}
                        />
                        <lightning-icon
                            class="slds-input__icon slds-input__icon_left"
                            icon-name="utility:search"
                            size="xx-small"
                        ></lightning-icon>
                    </div>
                </div>

                <div if:true={showNoFieldIllustration} class="noSupportedFieldsIllustration">
                    <builder_platform_interaction-illustration
                        illustration="lakeMountain"
                        title={labels.noFieldsIllustrationTitle}
                        body={labels.noFieldsIllustrationDescription}
                    ></builder_platform_interaction-illustration>
                </div>

                <builder_platform_interaction-palette
                    data={paletteData}
                    items-draggable="true"
                    icon-size="x-small"
                    onpaletteitemclicked={handlePaletteItemClickedEvent}
                    ondragstart={handleDragStart}
                    aria-label={entityLabel}
                >
                </builder_platform_interaction-palette>
            </div>
        </div>
    </div>
</template>
