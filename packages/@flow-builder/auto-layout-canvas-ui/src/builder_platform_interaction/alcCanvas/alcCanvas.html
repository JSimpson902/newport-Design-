<template>
    <div if:true={lastClickedElementGuid} class="canvas-overlay" onclick={handleOverlayClick}></div>
    <div if:true={showSpinner} class="slds-spinner_container">
        <lightning-spinner variant="brand"></lightning-spinner>
    </div>

    <div
        class="canvas"
        onclick={handleCanvasClick}
        onmenupositionupdate={handleMenuPositionUpdate}
        ontogglemenu={handleToggleMenu}
        onclosemenu={handleCloseMenu}
        onmouseenter={handleCanvasMouseEnter}
        onmouseleave={handleCanvasMouseLeave}
        onmousedown={handleCanvasMouseDown}
        onmouseup={handleCanvasMouseUp}
    >
        <template if:true={flow}>
            <div class="flow-container">
                <builder_platform_interaction-alc-flow
                    canvas-context={canvasContext}
                    class={flow.class}
                    disable-add-elements={disableAddElements}
                    disable-delete-elements={disableDeleteElements}
                    disable-edit-elements={disableEditElements}
                    flow={flow.flowInfo}
                    style={flow.style}
                    onalcselectdeselectnode={handleNodeSelectionDeselection}
                    onnoderesize={handleDynamicNodeRender}
                    ontabonmenutrigger={handleTabOnMenuTrigger}
                    active-element-guid={activeElementGuid}
                    flow-model={flow.flowModel}
                    onincominggotostubclick={handleHighlightAllOutgoingStubs}
                >
                </builder_platform_interaction-alc-flow>

                <div class={menuContainerClasses}>
                    <template if:true={showConnectorMenu}>
                        <x-lazy
                            lwc:dynamic={menu.ctor}
                            class={menu.className}
                            metadata={_connectorMenuMetadata}
                            can-add-goto={menu.canAddGoto}
                            source={menu.source}
                            elements-metadata={menu.elementsMetadata}
                            can-add-end-element={menu.canAddEndElement}
                            is-go-to-connector={menu.isGoToConnector}
                            is-paste-available={canvasContext.isPasteAvailable}
                            move-focus-to-menu={moveFocusToMenu}
                            style={menu.style}
                            ongotopath={handleAddOrRerouteGoToItemSelection}
                            onmovefocustoconnector={handleMoveFocusToConnector}
                        ></x-lazy>
                    </template>
                    <template if:true={showNodeMenu}>
                        <x-lazy
                            lwc:dynamic={menu.ctor}
                            class={menu.className}
                            condition-options={menu.conditionOptionsForNode}
                            disable-edit-elements={disableEditElements}
                            element-has-fault={menu.elementHasFault}
                            element-metadata={menu.elementMetadata}
                            guid={menu.source.guid}
                            move-focus-to-menu={moveFocusToMenu}
                            style={menu.style}
                            onhighlightpathstodelete={handleHighlightPathsToDelete}
                            onmovefocustonode={handleMoveFocusToNode}
                            flow-model={flow.flowModel}
                            ondeletebranchelement={handleBranchElementDeletion}
                            ondeleteelement={handleDeleteElement}
                            can-have-fault-connector={menu.canHaveFaultConnector}
                            disable-delete-elements={disableDeleteElements}
                            onclearhighlightedpath={handleClearHighlightedPath}
                        ></x-lazy>
                    </template>
                </div>
            </div>
        </template>
    </div>
    <builder_platform_interaction-zoom-panel
        is-zoom-in-disabled={isZoomInDisabled}
        is-zoom-out-disabled={isZoomOutDisabled}
        onclicktozoom={handleZoomAction}
    ></builder_platform_interaction-zoom-panel>
</template>
